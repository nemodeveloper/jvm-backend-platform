# jvm-backend-platform

## Базовые набор библиотек/зависимостей backend микросервиса

## Что необходимо для корректной работы библиотек
- 1 Gradle 8.8
- 2 Java 21 / Kotlin
- 3 SpringBoot 3.3.1

## Общая информация
- 1 Порядок сборки модулей указан в build-local.sh / build-nexus.sh
- 2 Зависимости между модулями в build.gradle.kts каждого модуля
- 3 Nexus https://nexus.bistrodengi.ru/#browse/browse:maven-releases

## Как версионировать библиотеки
- 0 Все библиотеки платформы ведутся под одной версией для удобства их поддержки и использования
- 1 Для изменения версии обновите переменную version в build.gradle.kts и platformVersion в settings.gradle.kts
- 2 Обновляем версию руководствуясь правилами semver2 https://semver.org/lang/ru/
- 3 Старайтесь проектировать ваше api библиотек чтобы его развитие не приводило потребителей к полному переписыванию их решения основой которого была ваша библиотека
- 4 После обновления библиотеки вносим изменения в файл README.md 
- 4.1 Дополняем секцию changelogs указываю что было изменено
- 4.1 Дополняем блоки использования библиотеки по необходимости

## Как добавить / доработать новую библиотеку?

### 1 - Сначала определяемся с базовым модулем к которому относится библиотека:
- 1.1 core - ядро на основе которого строятся другие библиотеки
- 1.2 integration - библиотеки связанные с базовыми решениями по интеграциям, например общий клиент для работы http/kafka/s3
- 1.3 db - библиотеки связанные с БД
- 1.4 security - библиотеки связанные с безопасностью

Если затрудняетесь с выбором обратитесь к tg://simanovan nemodev@yandex.ru

### 2 - Создаем новый модуль, для простоты решения можете скопировать 1 из модулей в котором создаете новую библиотеку и переименуйте его
- 2.1 Модуль должен содержать
- 2.1.1 build.gradle.kts файл сборки в котором нужно заменить artifactName на свой core-*, указать необходимые dependencies, больше ничего менять не нужно
- 2.1.2 README.md добавляем / обновляем по аналогии обязательные разделы описание / как подключать / что изменилось в новой версии / как конфигурировать application.yml и spring context / как использовать на примерах

### 3 - Создаем структуру библиотеки
- 3.1 Базовый пакет должен быть ru.nemodev.platform.* далее идет название вашей библиотеки
- 3.2 Просмотрите примеры других библиотек и придерживайтесь семантике их именования и иерархии пакетов
- 3.3 Resources, если вы создаете springboot-starter создаем папку META-INF/spring внутри файл org.springframework.boot.autoconfigure.AutoConfiguration.imports который содержит полное название классов конфигурации с вашими бинами

### 4 Добавление библиотеки в файлы сборки
- 1 В файле settings.gradle.kts находим подходящий по семантике блок, в него добавляем новую зависимость или обновляем существующую
- 2 Увеличиваем минорную или патч версию version в build.gradle.kts и platformVersion в settings.gradle.kts
- 3 Добавляем в файлы build-local/nexus.sh новую библиотеку или меняем порядок старых если изменились зависимости
- 3 После этого пересобираем и проверяем работы библиотек которые зависят от новых/обновленных зависимостей

### 5 - Локальная отладка библиотек при разработке
Для сборки и публикации в maven local всех модулей выполнить команду
``` bash
sh build-local.sh
```
- 5.1 Дорабатывая библиотеку есть необходимость собрать и проверить ее работу локально в связке с другими библиотеками или в своем сервисе
  В этом случае делаем clean build publishToMavenLocal.
  Не забывая изменить версию библиотек, после выполнения gradle tasks можете подключать новую версию библиотеки
- 5.2 В build.gradle.kts в блоке repositories добавляем
``` kotlin
repositories {
    mavenLocal()
}
```

### 6 - Публикация библиотек в nexus
В файле build.gradle.kts удобным для вас способом задать значения nexus user/password 
Для сборки всех модулей и публикации выполнить команду
``` bash
sh build-nexus.sh
```

### 7 - Как использовать разработанные библиотеки из nexus
- 7.1 Для того чтобы подключить к себе зависимость, которую опубликовали/обновили в nexus, добавляем в build.gradle.kts
``` kotlin
repositories {
    mavenCentral()
    maven { url = uri(System.getenv("NEXUS_URL") ?: "https://nexus.bistrodengi.ru/repository/maven-releases/") }
    mavenLocal()
}
```